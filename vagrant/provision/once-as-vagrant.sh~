#!/usr/bin/env bash

#== Bash helpers ==

function info {
  echo " "
  echo "--> $1"
  echo " "
}

#== Provision script ==

info "Provision-script user: `whoami`"

info "Install project dependencies"
cd /app
composer --no-progress --prefer-dist install

info "Import core databases"
# Import 'eco_core'
mysql -uroot eco_core < /app/vagrant/data/eco_core.dump.sql
#wget http://34.212.12.134/files/eco_core.dump.sql.zip -O /tmp/eco_core.dump.sql.zip
#unzip -P "xeiJai9auRahvape" /tmp/eco_core.dump.sql.zip -d /tmp
#mysql -uroot eco_core < /tmp/eco_core.dump.sql
#rm -rf /tmp/eco_core.dump.sql.zip
#rm -rf /tmp/eco_core.dump.sql
# Import 'eco_core_test'
mysql -uroot eco_core_test < /app/vagrant/data/eco_core_test.dump.sql
#wget http://34.212.12.134/files/eco_core_test.dump.sql.zip -O /tmp/eco_core_test.dump.sql.zip
#unzip -P "xeiJai9auRahvape" /tmp/eco_core_test.dump.sql.zip -d /tmp
#mysql -u root eco_core_test < /tmp/eco_core_test.dump.sql
#rm -rf /tmp/eco_core_test.dump.sql.zip
#rm -rf /tmp/eco_core_test.dump.sql

info "Apply migrations"
./bin/yii migrate --dbId=10 --interactive=0
./bin/yii_test migrate --dbId=10 --interactive=0
./bin/yii migrate-core --interactive=0
./bin/yii_test migrate-core --interactive=0

info "Create bash-alias 'app' for vagrant user"
echo 'alias app="cd /app"' | tee /home/vagrant/.bash_aliases

info "Enabling colorized prompt for guest console"
sed -i "s/#force_color_prompt=yes/force_color_prompt=yes/" /home/vagrant/.bashrc
